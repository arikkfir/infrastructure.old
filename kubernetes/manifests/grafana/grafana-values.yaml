serviceAccount:
  name: grafana
  annotations:
    iam.gke.io/gcp-service-account: grafana@arikkfir.iam.gserviceaccount.com

deploymentStrategy:
  type: Recreate

resources:
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

tolerations:
- key: kfirs.com/workload-nodes
  operator: Exists
affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
      - matchExpressions:
        - key: kfirs.com/workload-nodes
          operator: Exists

persistence:
  type: pvc
  enabled: true
  storageClassName: premium-rwo
  accessModes:
    - ReadWriteOnce
  size: 10Gi

adminUser: "$__file{/etc/secrets/grafana-admin-username}"
adminPassword: "$__file{/etc/secrets/grafana-admin-password}"

datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
    - name: Production Prometheus
      type: prometheus
      url: http://prometheus-server.prometheus
      access: proxy
      isDefault: true
    - name: Google Cloud Monitoring
      type: stackdriver
      access: proxy
      jsonData:
        authenticationType: gce

grafana.ini:
  server:
    root_url: "https://grafana.kfirs.com"
  auth.google:
    enabled: true
    client_id: "$__file{/etc/secrets/auth-google-oauth-client-id}"
    client_secret: "$__file{/etc/secrets/auth-google-oauth-client-secret}"
    scopes: "https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email"
    auth_url: "https://accounts.google.com/o/oauth2/auth"
    token_url: "https://accounts.google.com/o/oauth2/token"
    allowed_domains: "kfirs.com kfirfamily.com"
    allow_sign_up: true # this is only allowing signup from the allowed domains

extraSecretMounts:
  - name: grafana-secrets
    mountPath: /etc/secrets
    readOnly: true
    csi:
      driver: secrets-store.csi.k8s.io
      readOnly: true
      volumeAttributes:
        secretProviderClass: "grafana"
